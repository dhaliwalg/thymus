---
name: agents-md
description: >-
  Generate an AGENTS.md architectural rules section from your Thymus invariants.
  The output contains natural language rules that AI coding agents (Claude Code,
  Copilot, Cursor) read and follow during code generation. This is the "soft
  enforcement" complement to CI hard gates.
argument-hint: "[--stdout | --write]"
---

# Thymus AGENTS.md Generator

Generate architectural rules for AGENTS.md or CLAUDE.md from your `.thymus/invariants.yml`.

## Steps

**1. Generate the rules section**

Execute:
```bash
bash ${CLAUDE_PLUGIN_ROOT}/scripts/generate-agents-md.sh $PWD
```

Capture the full markdown output.

**2. Determine target file**

Check which file to write to:

- If `AGENTS.md` exists in the project root:
  - Look for a `## Architecture Rules` section
  - If found: replace everything from `<!-- Generated by Thymus -->` through the next `## ` heading (or end of file)
  - If not found: append the generated section at the end
- Else if `CLAUDE.md` exists in the project root:
  - Same logic: look for `## Architecture Rules` section, replace or append
- If neither exists:
  - Create `AGENTS.md` with the generated content

**3. Show preview**

Present the generated markdown to the user:

```
## Generated AGENTS.md Rules

[show the generated content]

---

This will be written to [AGENTS.md | CLAUDE.md]. Proceed? (y/n)
```

**4. Handle user response**

- If **yes**: write the content to the target file
- If **no** or adjustments requested: apply changes, re-preview
- If `--stdout` was passed: print to stdout only, don't write
- If `--write` was passed: write without confirmation

**5. Confirm**

Tell the user:
> Architecture rules written to [target file]. AI agents will now follow these rules when editing code in this project.
